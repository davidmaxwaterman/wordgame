<!DOCTYPE html>  <html> <head>   <title>listviewcontrols.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               listviewcontrols.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * jQuery Mobile Widget @VERSION - listview controls</span>
<span class="cm"> *</span>
<span class="cm"> * This software is licensed under the MIT licence (as defined by the OSI at</span>
<span class="cm"> * http://www.opensource.org/licenses/mit-license.php)</span>
<span class="cm"> * </span>
<span class="cm"> * ***************************************************************************</span>
<span class="cm"> * Copyright (C) 2011 by Intel Corporation Ltd.</span>
<span class="cm"> * </span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="cm"> * copy of this software and associated documentation files (the &quot;Software&quot;),</span>
<span class="cm"> * to deal in the Software without restriction, including without limitation</span>
<span class="cm"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class="cm"> * and/or sell copies of the Software, and to permit persons to whom the</span>
<span class="cm"> * Software is furnished to do so, subject to the following conditions:</span>
<span class="cm"> * </span>
<span class="cm"> * The above copyright notice and this permission notice shall be included in</span>
<span class="cm"> * all copies or substantial portions of the Software.</span>
<span class="cm"> * </span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="cm"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="cm"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<span class="cm"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class="cm"> * DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> * ***************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Authors: Elliot Smith &lt;elliot.smith@intel.com&gt;</span>
<span class="cm"> */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>This extension supplies API to toggle the "mode" in which a list
is displayed. The modes available is configurable, but defaults
to ['edit', 'view']. A list can also have a control panel associated
with it. The visibility of the control panel is governed by the current
mode (by default, it is visible in 'edit' mode); elements within
the listview can also be marked up to be visible in one or more of the
available modes.</p>

<p>One example use case would be a control panel with a "Select all" checkbox
which, when clicked, selects all of the checkboxes in the associated
listview items.</p>

<p>The control panel itself should be defined as a form element.
By default, the control panel will be hidden when the listview is
initialised, unless you supply mode="edit" as a
data-listview-controls option (when using the default modes). If you
want the control panel to be visible in some mode other than
the default, use a data-listviewcontrols-show-in="<mode>" attribute
on the control panel element.</p>

<p>Example usage (using the default 'edit' and 'view' modes):</p>

<!-- this is the controls element, displayed in 'edit' mode by default -->

<form id="listviewcontrols-control-panel">
  <fieldset data-role="controlgroup">
    <input type="checkbox" id="listviewcontrols-demo-checkbox-uber" />
    <label for="listviewcontrols-demo-checkbox-uber">Select all</label>
  </fieldset>
</form>

<!-- this is the list associated with the controls -->

<ul data-role="listview" data-listviewcontrols="#listviewcontrols-control-panel">

  <li>

    <!-- this element is only visible in 'edit' mode -->
    <fieldset data-role="controlgroup" data-listviewcontrols-show-in="edit">
      <input type="checkbox" id="listviewcontrols-demo-checkbox-1" />
      <label for="listviewcontrols-demo-checkbox-1">Greg</label>
    </fieldset>

    <!-- this element is only visible in 'view' mode -->
    <span data-listviewcontrols-show-in="view">Greg</span>

  </li>

  ... more li elements marked up the same way ...

</ul>

<p>To associate the listview with the control panel, add
data-listviewcontrols="..selector.." to a listview, where
selector selects a single element (the control panel
you defined). You can then call
listviewcontrols('option', 'mode', '<mode>') on the
listview to set the mode.</p>

<p>Inside the listview's items, add controls to each item
which are only visible when in one of the modes. To do this,
add form elements (e.g. checkboxes) to the items as you see fit. Then,
mark each form element with data-listviewcontrols-show-in="<mode>".
The control's visibility now depends on the mode of the listviewcontrols:
it is only shown when its <mode> setting matches the current mode
of the listviewcontrols widget. You are responsible for properly
styling the form elements inside the listview so the listview looks
correct when they are hidden or visible.</p>

<p>The control panel (by default, visible when in "show" mode) is flexible
and can contain any valid form elements (or other jqm components). It's
up to you to define the behaviour associated with interactions on
the control panel and/or controls inside list items.</p>

<p>Methods:</p>

<p>visibleListItems
    Returns a jQuery object containing all the li elements in the
    listview which are currently visible and not dividers. (This
    is just a convenience to make operating on the list as a whole
    slightly simpler.)</p>

<p>Options (set in options hash passed to constructor, or via the
option method, or declaratively by attribute described below):</p>

<p>controlPanelSelector {String}
    Selector string for selecting the element representing the
    control panel for the listview. The context for find() is the
    document (to give the most flexibility), so your selector
    should be specific. Set declaratively with
      data-listviewcontrols="...selector...".</p>

<p>modesAvailable {String[]; default=['edit', 'view']}
    An array of the modes available for these controls.</p>

<p>mode {String; default='view'}
    Current mode for the widget, which governs the visibility
    of the listview control panel and any elements marked
    with data-listviewcontrols-show-in="<mode>".
    Set declaratively with
      data-listviewcontrols-options='{"mode":"<mode>"}'.</p>

<p>controlPanelShowIn {String; default=modesAvailable[0]}
    The mode in which the control panel is visible; defaults to the
    first element of modesAvailable. Can be set declaratively
    on the listview controls element with
      data-listviewcontrols-show-in="<mode>"</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">widget</span><span class="p">(</span><span class="s2">&quot;todons.listviewcontrols&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">mobile</span><span class="p">.</span><span class="nx">widget</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">_defaults</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">controlPanelSelector</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">modesAvailable</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;edit&#39;</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">],</span>
        <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;view&#39;</span><span class="p">,</span>
        <span class="nx">controlPanelShowIn</span><span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>

    <span class="nx">_listviewCssClass</span><span class="o">:</span> <span class="s1">&#39;ui-listviewcontrols-listview&#39;</span><span class="p">,</span>
    <span class="nx">_controlsCssClass</span><span class="o">:</span> <span class="s1">&#39;ui-listviewcontrols-panel&#39;</span><span class="p">,</span>

    <span class="nx">_create</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">o</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
            <span class="nx">optionsValid</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.ui-page&#39;</span><span class="p">),</span>
            <span class="nx">controlPanelSelectorAttr</span> <span class="o">=</span> <span class="s1">&#39;data-&#39;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">.</span><span class="nx">mobile</span><span class="p">.</span><span class="nx">ns</span> <span class="o">+</span> <span class="s1">&#39;listviewcontrols&#39;</span><span class="p">,</span>
            <span class="nx">controlPanelSelector</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">controlPanelSelectorAttr</span><span class="p">),</span>
            <span class="nx">dataOptions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">jqmData</span><span class="p">(</span><span class="s1">&#39;listviewcontrols-options&#39;</span><span class="p">),</span>
            <span class="nx">controlPanelShowInAttr</span><span class="p">;</span>

        <span class="nx">o</span><span class="p">.</span><span class="nx">controlPanelSelector</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">controlPanelSelector</span> <span class="o">||</span> <span class="nx">controlPanelSelector</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>precedence for options: defaults &lt; jqmData attribute &lt; options arg</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">o</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">_defaults</span><span class="p">,</span> <span class="nx">dataOptions</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>

        <span class="nx">optionsValid</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_validOption</span><span class="p">(</span><span class="s1">&#39;modesAvailable&#39;</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">modesAvailable</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">_validOption</span><span class="p">(</span><span class="s1">&#39;controlPanelSelector&#39;</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">controlPanelSelector</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">_validOption</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">mode</span><span class="p">,</span> <span class="nx">o</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">optionsValid</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>get the controls element</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">controlPanel</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">controlPanelSelector</span><span class="p">).</span><span class="nx">first</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">controlPanel</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>once we have the controls element, we may need to override the
mode in which controls are shown</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">controlPanelShowInAttr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">controlPanel</span><span class="p">.</span><span class="nx">jqmData</span><span class="p">(</span><span class="s1">&#39;listviewcontrols-show-in&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">controlPanelShowInAttr</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">controlPanelShowIn</span> <span class="o">=</span> <span class="nx">controlPanelShowInAttr</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">controlPanelShowIn</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">o</span><span class="p">.</span><span class="nx">controlPanelShowIn</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">modesAvailable</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validOption</span><span class="p">(</span><span class="s1">&#39;controlPanelShowIn&#39;</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">controlPanelShowIn</span><span class="p">,</span> <span class="nx">o</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>done setting options</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>mark the controls and the list with a class</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_listviewCssClass</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_listviewCssClass</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">controlPanel</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_controlsCssClass</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_controlsCssClass</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>show the widget</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">page</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">page</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;:visible&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">page</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;pageshow&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span> <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_validOption</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">varName</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">otherOptions</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">varName</span> <span class="o">===</span> <span class="s1">&#39;mode&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ok</span> <span class="o">=</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">otherOptions</span><span class="p">.</span><span class="nx">modesAvailable</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">varName</span> <span class="o">===</span> <span class="s1">&#39;controlPanelSelector&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ok</span> <span class="o">=</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">varName</span> <span class="o">===</span> <span class="s1">&#39;modesAvailable&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ok</span> <span class="o">=</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">ok</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">varName</span> <span class="o">===</span> <span class="s1">&#39;controlPanelShowIn&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ok</span> <span class="o">=</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">otherOptions</span><span class="p">.</span><span class="nx">modesAvailable</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">ok</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_setOption</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">varName</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">oldValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">varName</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">oldValue</span> <span class="o">!==</span> <span class="nx">value</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_validOption</span><span class="p">(</span><span class="nx">varName</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">varName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">visibleListItems</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;li:not(:jqmData(role=list-divider)):visible&#39;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">refresh</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">triggerUpdateLayout</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">showIn</span><span class="p">,</span>
            <span class="nx">modalElements</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>hide/show the control panel and hide/show controls inside
list items based on their "show-in" option</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">isVisible</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">controlPanel</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;:visible&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">mode</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">controlPanelShowIn</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">controlPanel</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">controlPanel</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">controlPanel</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;:visible&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">isVisible</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">triggerUpdateLayout</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>we only operate on elements inside list items which aren't dividers</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">modalElements</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;li:not(:jqmData(role=list-divider))&#39;</span><span class="p">)</span>
                                    <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;:jqmData(listviewcontrols-show-in)&#39;</span><span class="p">);</span>

        <span class="nx">modalElements</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">showIn</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">jqmData</span><span class="p">(</span><span class="s1">&#39;listviewcontrols-show-in&#39;</span><span class="p">);</span>

            <span class="nx">isVisible</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;:visible&#39;</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">showIn</span> <span class="o">===</span> <span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;:visible&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">isVisible</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">triggerUpdateLayout</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">triggerUpdateLayout</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;updatelayout&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s1">&#39;listviewcreate&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;:jqmData(listviewcontrols)&#39;</span><span class="p">))</span> <span class="p">{</span>
		<span class="nx">list</span><span class="p">.</span><span class="nx">listviewcontrols</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">});</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 