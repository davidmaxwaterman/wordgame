<!DOCTYPE html>  <html> <head>   <title>optionheader.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               optionheader.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * jQuery Mobile Widget @VERSION</span>
<span class="cm"> *</span>
<span class="cm"> * This software is licensed under the MIT licence (as defined by the OSI at</span>
<span class="cm"> * http://www.opensource.org/licenses/mit-license.php)</span>
<span class="cm"> *</span>
<span class="cm"> * ***************************************************************************</span>
<span class="cm"> * Copyright (C) 2011 by Intel Corporation Ltd.</span>
<span class="cm"> *</span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="cm"> * copy of this software and associated documentation files (the &quot;Software&quot;),</span>
<span class="cm"> * to deal in the Software without restriction, including without limitation</span>
<span class="cm"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class="cm"> * and/or sell copies of the Software, and to permit persons to whom the</span>
<span class="cm"> * Software is furnished to do so, subject to the following conditions:</span>
<span class="cm"> *</span>
<span class="cm"> * The above copyright notice and this permission notice shall be included in</span>
<span class="cm"> * all copies or substantial portions of the Software.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="cm"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="cm"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<span class="cm"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class="cm"> * DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> * ***************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Authors: Elliot Smith &lt;elliot.smith@intel.com&gt;</span>
<span class="cm"> */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>optionheader provides a collapsible toolbar for buttons and
segmented controls directly under the title bar. It
wraps a jQuery Mobile grid in a collapsible container; clicking
on the container, or on one of the buttons inside the container,
will collapse it.</p>

<p>To add an option header to a page, mark up the header with a
data-role="optionheader" attribute, as shown in this example:</p>

<div data-role="header">
    <h1>Option header - 3 buttons example</h1>
    <div data-role="optionheader">
       <div class="ui-grid-b">
            <div class="ui-block-a"><a data-role="button">Previous</a></div>
            <div class="ui-block-b"><a data-role="button">Cancel</a></div>
            <div class="ui-block-c"><a data-role="button">Next</a></div>
       </div>
    </div>
</div>

<p>The optionheader can also be used inline (e.g. in a content block or
a widget).</p>

<p>Alternatively, use $('...').optionheader() to apply programmatically.</p>

<p>The grid inside the optionheader should be marked up as for
a standard jQuery Mobile grid. (The widget has been tested with one
or two rows of 2-4 columns each.)</p>

<p>Note that if you use this with fixed headers, you may find that
expanding the option header increases the page size so that scrollbars
appear (jQuery Mobile's own collapsible content areas cause the
same issue). You can alleviate this somewhat by calling the show() method
on the page toolbars each time the size of the header changes.</p>

<p>The widget is configurable via a data-options attribute on the same
div as the data-role="optionheader" attribute, e.g.</p>

<div data-role="header">
    <h1>Option header - configured</h1>
    <div data-role="optionheader" data-options='{"collapsed":true, "duration":1.5}'>
       <div class="ui-grid-b">
            <div class="ui-block-a"><a data-role="button">Previous</a></div>
            <div class="ui-block-b"><a data-role="button">Cancel</a></div>
            <div class="ui-block-c"><a data-role="button">Next</a></div>
       </div>
    </div>
</div>

<p>Options can also be set with $(...).optionheader('option', 'name', value).
However, if you do this, you'll need to call $(...).optionheader('refresh')
afterwards for the new values to take effect (note that optionheader()
can be applied multiple times to an element without side effects).</p>

<p>See below for the available options.</p>

<p>Theme: by default, gets a 'b' swatch; override with data-theme="X"
as per usual</p>

<p>Options (can be set with a data-options attribute):</p>

<p>{Boolean} [showIndicator=true] Set to true (the default) to show
  the upward-pointing arrow indicator on top of the title bar.
  {Boolean} [startCollapsed=false] Sets the appearance when the option
  header is first displayed; defaults to false (i.e. show the header
  expanded on first draw). NB setting this option later has no
  effect: use collapse() to collapse a widget which is already
  drawn.
  {Boolean} [expandable=true] Sets whether the header will expand
  in response to clicks; default = true.
  {Float} [duration=0.25] Duration of the expand/collapse animation.</p>

<p>Methods (see below for docs):</p>

<p>toggle(options)
  expand(options)
  collapse(options)</p>

<p>Events:</p>

<p>expand: Triggered when the option header is expanded
  collapse: Triggered when the option header is collapsed</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">widget</span><span class="p">(</span><span class="s2">&quot;todons.optionheader&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">todons</span><span class="p">.</span><span class="nx">widgetex</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">initSelector</span><span class="o">:</span> <span class="s2">&quot;:jqmData(role=&#39;optionheader&#39;)&quot;</span><span class="p">,</span>
        <span class="nx">showIndicator</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">theme</span><span class="o">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
        <span class="nx">startCollapsed</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">expandable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">duration</span><span class="o">:</span> <span class="mf">0.25</span>
    <span class="p">},</span>

    <span class="nx">collapsedHeight</span><span class="o">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span>

    <span class="nx">_create</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">theme</span><span class="p">,</span>
            <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">parentPage</span><span class="p">,</span>
            <span class="nx">dataOptions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">jqmData</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>parse data-options</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span> <span class="nx">dataOptions</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">isCollapsed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">expandedHeight</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>parse data-theme and reset options.theme if it's present</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">theme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">jqmData</span><span class="p">(</span><span class="s1">&#39;theme&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">theme</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">theme</span> <span class="o">=</span> <span class="nx">theme</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>set up the click handler; it's done here so it can
easily be removed, as there should only be one instance
of the handler function for each class instance</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">toggle</span><span class="p">();</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>get the element's dimensions
and to set its initial collapse state;
either do it now (if the page is visible already)
or on pageshow</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;:jqmData(role=&quot;page&quot;)&#39;</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="nx">_realize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">expandedHeight</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">expandedHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">startCollapsed</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">collapse</span><span class="p">({</span><span class="nx">duration</span><span class="o">:</span> <span class="mi">0</span><span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Draw the option header, according to current options</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">refresh</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span>
            <span class="nx">arrow</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;ui-option-header-triangle-arrow&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">),</span>
            <span class="nx">optionHeaderClass</span> <span class="o">=</span> <span class="s1">&#39;ui-option-header&#39;</span><span class="p">,</span>
            <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">gridRowSelector</span> <span class="o">=</span> <span class="s1">&#39;.ui-grid-a,.ui-grid-b,.ui-grid-c,.ui-grid-d,.ui-grid-e&#39;</span><span class="p">,</span>
            <span class="nx">theme</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">theme</span><span class="p">,</span>
            <span class="nx">numRows</span><span class="p">,</span>
            <span class="nx">rowsClass</span><span class="p">,</span>
            <span class="nx">themeClass</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>count ui-grid-* elements to get number of rows</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">numRows</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">gridRowSelector</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>...at least one row</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">numRows</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">numRows</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>add classes to outer div:
  ui-option-header-N-row, where N = options.rows
  ui-bar-X, where X = options.theme (defaults to 'c')
  ui-option-header</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">rowsClass</span> <span class="o">=</span> <span class="s1">&#39;ui-option-header-&#39;</span> <span class="o">+</span> <span class="nx">numRows</span> <span class="o">+</span> <span class="s1">&#39;-row&#39;</span><span class="p">;</span>
        <span class="nx">themeClass</span> <span class="o">=</span> <span class="s1">&#39;ui-body-&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">theme</span><span class="p">;</span>

        <span class="nx">el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">rowsClass</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">rowsClass</span><span class="p">);</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">themeClass</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">themeClass</span><span class="p">);</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">optionHeaderClass</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">optionHeaderClass</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>remove any arrow currently visible</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">el</span><span class="p">.</span><span class="nx">prev</span><span class="p">(</span><span class="s1">&#39;.ui-option-header-triangle-arrow&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>if there are elements inside the option header
and this.options.showIndicator,
insert a triangle arrow as the first element inside the
optionheader div to show the header has hidden content</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">showIndicator</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">el</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">arrow</span><span class="p">);</span>
            <span class="nx">arrow</span><span class="p">.</span><span class="nx">triangle</span><span class="p">({</span><span class="s2">&quot;color&quot;</span><span class="o">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">),</span> <span class="nx">offset</span><span class="o">:</span> <span class="s2">&quot;50%&quot;</span><span class="p">});</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>if expandable, bind clicks to the toggle() method</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">expandable</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">el</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;vclick&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;vclick&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">);</span>
            <span class="nx">arrow</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;vclick&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;vclick&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">el</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;vclick&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">);</span>
            <span class="nx">arrow</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;vclick&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>for each ui-grid-* element, add a class ui-option-header-row-M
to it, where M is the xpath position() of the div</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">gridRowSelector</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">klass</span> <span class="o">=</span> <span class="s1">&#39;ui-option-header-row-&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">klass</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">klass</span><span class="p">);</span>
        <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>redraw the buttons (now that the optionheader has the right
swatch)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.ui-btn&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-&#39;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">.</span><span class="nx">mobile</span><span class="p">.</span><span class="nx">ns</span> <span class="o">+</span> <span class="s1">&#39;theme&#39;</span><span class="p">,</span> <span class="nx">theme</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>hack the class of the button to remove the old swatch</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">klass</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">);</span>

            <span class="nx">klass</span> <span class="o">=</span> <span class="nx">klass</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ui-btn-up-\w{1}\s*/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="nx">klass</span> <span class="o">=</span> <span class="nx">klass</span> <span class="o">+</span> <span class="s1">&#39; ui-btn-up-&#39;</span> <span class="o">+</span> <span class="nx">theme</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="nx">klass</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">_setHeight</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">height</span><span class="p">,</span> <span class="nx">isCollapsed</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">duration</span><span class="p">,</span>
            <span class="nx">commonCallback</span><span class="p">,</span>
            <span class="nx">callback</span><span class="p">;</span>

        <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>set default duration if not specified</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">duration</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">duration</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">duration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>the callback to always call after expanding or collapsing</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">commonCallback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">isCollapsed</span> <span class="o">=</span> <span class="nx">isCollapsed</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">isCollapsed</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;collapse&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;expand&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>combine commonCallback with any user-specified callback</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">();</span>
                <span class="nx">commonCallback</span><span class="p">();</span>
            <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">commonCallback</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>apply the animation</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">cssTransitions</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>add a handler to invoke a callback when the animation is done</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">elt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">handleEvent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">elt</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;webkitTransitionEnd&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;-webkit-transition&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
                    <span class="nx">callback</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="nx">elt</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;webkitTransitionEnd&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>apply the transition</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;-webkit-transition&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;height &#39;</span> <span class="o">+</span> <span class="nx">duration</span> <span class="o">+</span> <span class="s1">&#39;s ease-out&#39;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>make sure the callback gets called even when there's no
animation</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
            <span class="nx">callback</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Toggle the expanded/collapsed state of the widget.
{Object} [options] Configuration for the expand/collapse
{Integer} [options.duration] Duration of the expand/collapse;
defaults to this.options.duration
{Function} [options.callback] Function to call after toggle completes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">toggle</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isCollapsed</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">expand</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">collapse</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Takes the same options as toggle()</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">collapse</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isCollapsed</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_setHeight</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collapsedHeight</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Takes the same options as toggle()</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">expand</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isCollapsed</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_setHeight</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">expandedHeight</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>auto self-init widgets</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;pagecreate&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">todons</span><span class="p">.</span><span class="nx">optionheader</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">initSelector</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">not</span><span class="p">(</span><span class="s2">&quot;:jqmData(role=&#39;none&#39;), :jqmData(role=&#39;nojs&#39;)&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">optionheader</span><span class="p">();</span>
<span class="p">});</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 