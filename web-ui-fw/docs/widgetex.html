<!DOCTYPE html>  <html> <head>   <title>widgetex.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               widgetex.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * This software is licensed under the MIT licence (as defined by the OSI at</span>
<span class="cm"> * http://www.opensource.org/licenses/mit-license.php)</span>
<span class="cm"> * </span>
<span class="cm"> * ***************************************************************************</span>
<span class="cm"> * Copyright (C) 2011 by Intel Corporation Ltd.</span>
<span class="cm"> * </span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="cm"> * copy of this software and associated documentation files (the &quot;Software&quot;),</span>
<span class="cm"> * to deal in the Software without restriction, including without limitation</span>
<span class="cm"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class="cm"> * and/or sell copies of the Software, and to permit persons to whom the</span>
<span class="cm"> * Software is furnished to do so, subject to the following conditions:</span>
<span class="cm"> * </span>
<span class="cm"> * The above copyright notice and this permission notice shall be included in</span>
<span class="cm"> * all copies or substantial portions of the Software.</span>
<span class="cm"> * </span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="cm"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="cm"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<span class="cm"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class="cm"> * DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> * ***************************************************************************</span>
<span class="cm"> */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Base class for widgets that need the following features:</p>

<p>I. HTML prototype loading</p>

<p>This class provides HTML prototype loading for widgets. That is, the widget implementation specifies its HTML portions
in one continuous HTML snippet, and it optionally provides an object containing selectors into the various parts of the
HTML snippet. This widget loads the HTML snippet into a jQuery object, and optionally assigns jQuery objects to each of
the selectors in the optionally provided object.</p>

<p>To use this functionality you can either derive from this class, or you can call its prototype's gtype method.</p>

<ol>
<li>Widgets deriving from this class should define _htmlProto as part of their prototype declaration. _htmlProto looks like
this:</li>
</ol>

<p>_htmlProto: {
    source: string|jQuery object (optional) default: string - The name of the widget
    ui: {
        uiElement1: "#ui-element-1-selector",
        uiElement2: "#ui-element-2-selector",
        ...
        subElement: {
            subElement1: "#sub-element-1-selector",
            subElement2: "#sub-element-2-selector",
            ...
        }
        ...
    }
}</p>

<p>If neither 'source' nor 'ui' are defined, you must still include an empty <em>htmlProto key (</em>htmlProto: {}) to indicate
that you wish to make use of this feature. This will cause a prototype HTML file named after your widget to be loaded.
The loaded prototype will be placed into your widget's prototype's _protoHtml.source key.</p>

<p>If 'source' is defined as a string, it is the name of the widget (including namespace). This is the default. If your
widget's HTML prototype is loaded via AJAX and the name of the AJAX file is different from the name of your widget
(that is, it is not "<widgetName>.prototype.html", then you should explicitly define 'source' as:</p>

<p>If you wish to load HTML prototypes via AJAX, modify the getProtoPath() function defined below to reflect the directory
structure holding your widget HTML prototypes.</p>

<p>source: "alternateWidgetName"</p>

<p>If AJAX loading fails, source is set to a jQuery object containing a div with an error message. You can check whether
loading failed via the jQuery object's jqmData("todons.widgetex.ajax.fail") data item. If false, then the jQuery object
is the actual prototype loaded via AJAX or present inline. Otherwise, the jQuery object is the error message div.</p>

<p>If 'source' is defined as a jQuery object, it is considered already loaded.</p>

<p>if 'ui' is defined inside _htmlProto, It is assumed to be an object such that every one of its keys is either a string,
or another object with the same properties as itself.</p>

<p>When a widget is instantiated, the HTML prototype is loaded if not already present in the prototype. If 'ui' is present
inside <em>htmlProto, the prototype is cloned. Then, a new structure is created based on 'ui' with each selector replaced
by a jQuery object containing the results of performing .find() on the prototype's clone with the filter set to the
value of the string. In the special case where the selector starts with a '#', the ID is removed from the element after
it is assigned into the structure being created. This structure is then made accessible from the widget instance via
the '</em>ui' key (i.e., this._ui).</p>

<ol>
<li>Use the loadPrototype method when your widget does not derive from $.todons.widgetex:
Add _htmlProto to your widget's prototype as described above. Then, in your widget's _create() method, call
loadPrototype in the following manner:</li>
</ol>

<p>$.todons.widgetex.loadPrototype.call(this, "namespace.widgetName");</p>

<p>Thereafter, you may use the HTML prototype from your widget's prototype or, if you have specified a 'ui' key in your
<em>htmlProto key, you may use this.</em>ui from your widget instance.</p>

<p>II. realize method</p>

<p>When a widget is created, some of its properties cannot be set immediately, because they depend on the widths/heights
of its constituent elements. They can only be calculated when the page containing the widget is made visible via the
"pageshow" event, because widths/heights always evaluate to 0 when retrieved from a widget that is not visible. When
you inherit from widgetex, you can add a "_realize" function to your prototype. This function will be called once right
after _create() if the element that anchors your widget is on a visible page. Otherwise, it will be called when the
page to which the widget belongs emits the "pageshow" event.</p>

<p>III. systematic option handling</p>

<p>If a widget has lots of options, the _setOption function can become a long switch for setting each recognized option.
It is also tempting to allow options to determine the way a widget is created, by basing decisions on various options
during _create(). Often, the actions based on option values in _create() are the same as those in _setOption. To avoid
such code duplication, this class calls _setOption once for each option after _create() has completed.</p>

<p>Furthermore, to avoid writing long switches in a widget's _setOption method, this class implements _setOption in such
a way that, for any given option (e.g. "myOption"), _setOption looks for a method _setMyOption in the widget's
implementation, and if found, calls the method with the value of the option.</p>

<p>If your widget does not inherit from widgetex, you can still use widgetex' systematic option handling:
1. define the <em>setOption method for your widget as follows:
     _setOption: $.todons.widgetex.prototype.</em>setOption
2. Call this._setOptions(this.options) from your widget's _create() function.
3. As with widgetex-derived widgets, implement a corresponding _setMyOptionName function for each option myOptionName
you wish to handle.</p>

<p>IV. systematic value handling for input elements</p>

<p>If your widget happens to be constructed from an <input> element, you have to handle the "value" attribute specially,
and you have to emit the "change" signal whenever it changes, in addition to your widget's normal signals and option
changes. With widgetex, you can assign one of your widget's "data-*" properties to be synchronized to the "value"
property whenever your widget is constructed onto an <input> element. To do this, define, in your prototype:</p>

<p>_value: {
     attr: "data-my-attribute",
     signal: "signal-to-emit"
}</p>

<p>Then, call this._setValue(newValue) whenever you wish to set the value for your widget. This will set the data-*
attribute, emit the custom signal (if set) with the new value as its parameter, and, if the widget is based on an
<input> element, it will also set the "value" attribute and emit the "change" signal.</p>

<p>"attr" is required if you choose to define "<em>value", and identifies the data-attribute to set in addition to "value",
if your widget's element is an input.
"signal" is optional, and will be emitted when setting the data-attribute via this.</em>setValue(newValue).</p>

<p>If your widget does not derive from widgetex, you can still define "_value" as described above and call
$.todons.widgetex.setValue(widget, newValue).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Framework-specific HTML prototype path for AJAX loads</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">getProtoPath</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">theScriptTag</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;script[data-framework-version][data-framework-root][data-framework-theme]&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="nx">theScriptTag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;data-framework-root&quot;</span><span class="p">)</span>    <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span>
            <span class="nx">theScriptTag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;data-framework-version&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/themes/&quot;</span> <span class="o">+</span> 
            <span class="nx">theScriptTag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;data-framework-theme&quot;</span><span class="p">)</span>   <span class="o">+</span> <span class="s2">&quot;/proto-html&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">widget</span><span class="p">(</span><span class="s2">&quot;todons.widgetex&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">mobile</span><span class="p">.</span><span class="nx">widget</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">_createWidget</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">todons</span><span class="p">.</span><span class="nx">widgetex</span><span class="p">.</span><span class="nx">loadPrototype</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">mobile</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_createWidget</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.ui-page&quot;</span><span class="p">),</span>
            <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;:visible&quot;</span><span class="p">))</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_realize</span><span class="p">();</span>
        <span class="k">else</span>
            <span class="nx">page</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;pageshow&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_realize</span><span class="p">();</span> <span class="p">});</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_setOptions</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_getCreateOptions</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>if we're dealing with an <input> element, value takes precedence over corresponding data-* attribute, if a
mapping has been established via this._value. So, assign the value to the data-* attribute, so that it may
then be assigned to this.options in the superclass' _getCreateOptions</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">theValue</span> <span class="o">=</span>
                <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;checkbox&quot;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;radio&quot;</span><span class="p">)</span>
                    <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;:checked&quot;</span><span class="p">)</span>
                    <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;[value]&quot;</span><span class="p">)</span>
                        <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                        <span class="o">:</span> <span class="kc">undefined</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">theValue</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">.</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">theValue</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">mobile</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getCreateOptions</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_setOption</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">setter</span> <span class="o">=</span> <span class="s2">&quot;_set&quot;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[a-z]/</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();});</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">setter</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span>
            <span class="k">this</span><span class="p">[</span><span class="nx">setter</span><span class="p">](</span><span class="nx">value</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">mobile</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setOption</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_setValue</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">todons</span><span class="p">.</span><span class="nx">widgetex</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_realize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">});</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">todons</span><span class="p">.</span><span class="nx">widgetex</span><span class="p">.</span><span class="nx">setValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">widget</span><span class="p">.</span><span class="nx">_value</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">widget</span><span class="p">.</span><span class="nx">_value</span><span class="p">.</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">widget</span><span class="p">.</span><span class="nx">_value</span><span class="p">.</span><span class="nx">signal</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span>
            <span class="nx">widget</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">triggerHandler</span><span class="p">(</span><span class="nx">widget</span><span class="p">.</span><span class="nx">_value</span><span class="p">.</span><span class="nx">signal</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">widget</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">inputType</span> <span class="o">=</span> <span class="nx">widget</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Special handling for checkboxes and radio buttons, where the presence of the "checked" attribute is really
the value</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">inputType</span> <span class="o">===</span> <span class="s2">&quot;checkbox&quot;</span> <span class="o">||</span> <span class="nx">inputType</span> <span class="o">===</span> <span class="s2">&quot;radio&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span><span class="p">)</span>
                    <span class="nx">widget</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;checked&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                <span class="k">else</span>
                    <span class="nx">widget</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;checked&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
                <span class="nx">widget</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">);</span>
            <span class="nx">widget</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">todons</span><span class="p">.</span><span class="nx">widgetex</span><span class="p">.</span><span class="nx">loadPrototype</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ar</span> <span class="o">=</span> <span class="nx">widget</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">ar</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">namespace</span> <span class="o">=</span> <span class="nx">ar</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">widgetName</span> <span class="o">=</span> <span class="nx">ar</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

        <span class="kd">var</span> <span class="nx">htmlProto</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&lt;/div&gt;&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Failed to load proto for widget &quot;</span> <span class="o">+</span> <span class="nx">namespace</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">widgetName</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">background</span><span class="o">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="nx">border</span><span class="o">:</span> <span class="s2">&quot;1px solid black&quot;</span><span class="p">})</span>
                <span class="p">.</span><span class="nx">jqmData</span><span class="p">(</span><span class="s2">&quot;todons.widgetex.ajax.fail&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>If htmlProto is defined</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">widgetName</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_htmlProto</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>If no source is defined, use the widget name</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">widgetName</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_htmlProto</span><span class="p">.</span><span class="nx">source</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span>
                <span class="nx">$</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">widgetName</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_htmlProto</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">widgetName</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Load the HTML prototype via AJAX if not defined inline</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">$</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">widgetName</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_htmlProto</span><span class="p">.</span><span class="nx">source</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Establish the path for the proto file</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">widget</span> <span class="o">=</span> <span class="nx">$</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">widgetName</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_htmlProto</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span>
                    <span class="nx">protoPath</span> <span class="o">=</span> <span class="nx">getProtoPath</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Make the AJAX call</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                    <span class="nx">url</span><span class="o">:</span> <span class="nx">protoPath</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">widget</span> <span class="o">+</span> <span class="s2">&quot;.prototype.html&quot;</span><span class="p">,</span>
                    <span class="nx">async</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                    <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;html&quot;</span>
                <span class="p">}).</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">htmlProto</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&lt;/div&gt;&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">jqmData</span><span class="p">(</span><span class="s2">&quot;todons.widgetex.ajax.fail&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
                <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Assign the HTML proto to the widget prototype</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">widgetName</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_htmlProto</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">htmlProto</span><span class="p">;</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Otherwise, use the inline definition</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>AJAX loading has trivially succeeded, since there was no AJAX loading at all</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">widgetName</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_htmlProto</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">jqmData</span><span class="p">(</span><span class="s2">&quot;todons.widgetex.ajax.fail&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
                <span class="nx">htmlProto</span> <span class="o">=</span> <span class="nx">$</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">widgetName</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_htmlProto</span><span class="p">.</span><span class="nx">source</span><span class="p">;</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>If there's a "ui" portion in the HTML proto, copy it over to this instance, and
replace the selectors with the selected elements from a copy of the HTML prototype</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">widgetName</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_htmlProto</span><span class="p">.</span><span class="nx">ui</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Assign the relevant parts of the proto</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">function</span> <span class="nx">assignElements</span><span class="p">(</span><span class="nx">proto</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">((</span><span class="k">typeof</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">proto</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^#/</span><span class="p">))</span>
                                <span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="k">if</span> <span class="p">((</span><span class="k">typeof</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span>
                            <span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">assignElements</span><span class="p">(</span><span class="nx">proto</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
                    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">_ui</span><span class="o">:</span> <span class="nx">assignElements</span><span class="p">(</span><span class="nx">htmlProto</span><span class="p">.</span><span class="nx">clone</span><span class="p">(),</span> <span class="nx">$</span><span class="p">[</span><span class="nx">namespace</span><span class="p">][</span><span class="nx">widgetName</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_htmlProto</span><span class="p">.</span><span class="nx">ui</span><span class="p">)</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 